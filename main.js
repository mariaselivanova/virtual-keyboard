(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,i){for(var a=0;a<i.length;a++){var n=i[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,s=function(t,i){if("object"!==e(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,"string");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===e(s)?s:String(s)),n)}var s}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=null,this.keys=t}var i,a;return i=e,(a=[{key:"init",value:function(){this.container=document.createElement("div"),this.container.classList.add("keyboard"),this.container.append(this.keys),document.body.append(this.container)}},{key:"updateLanguage",value:function(e){document.querySelector(".keyboard").remove(),this.keys=e,this.init()}}])&&t(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),e}(),a=[{code:"Backquote",key:"`"},{code:"Digit1",key:"1"},{code:"Digit2",key:"2"},{code:"Digit3",key:"3"},{code:"Digit4",key:"4"},{code:"Digit5",key:"5"},{code:"Digit6",key:"6"},{code:"Digit7",key:"7"},{code:"Digit8",key:"8"},{code:"Digit9",key:"9"},{code:"Digit0",key:"0"},{code:"Minus",key:"-"},{code:"Equal",key:"="},{code:"Backspace",key:"backspace"},{code:"Tab",key:"tab"},{code:"KeyQ",key:"q"},{code:"KeyW",key:"w"},{code:"KeyE",key:"e"},{code:"KeyR",key:"r"},{code:"KeyT",key:"t"},{code:"KeyY",key:"y"},{code:"KeyU",key:"u"},{code:"KeyI",key:"i"},{code:"KeyO",key:"o"},{code:"KeyP",key:"p"},{code:"BracketLeft",key:"["},{code:"BracketRight",key:"]"},{code:"Backslash",key:"\\"},{code:"Delete",key:"del"},{code:"CapsLock",key:"caps"},{code:"KeyA",key:"a"},{code:"KeyS",key:"s"},{code:"KeyD",key:"d"},{code:"KeyF",key:"f"},{code:"KeyG",key:"g"},{code:"KeyH",key:"h"},{code:"KeyJ",key:"j"},{code:"KeyK",key:"k"},{code:"KeyL",key:"l"},{code:"Semicolon",key:";"},{code:"Quote",key:"'"},{code:"Enter",key:"enter"},{code:"ShiftLeft",key:"shiftLeft"},{code:"KeyZ",key:"z"},{code:"KeyX",key:"x"},{code:"KeyC",key:"c"},{code:"KeyV",key:"v"},{code:"KeyB",key:"b"},{code:"KeyN",key:"n"},{code:"KeyM",key:"m"},{code:"Comma",key:","},{code:"Period",key:"."},{code:"Slash",key:"/"},{code:"ArrowUp",key:"▲"},{code:"ShiftRight",key:"shiftRight"},{code:"ControlLeft",key:"ctrlLeft"},{code:"MetaLeft",key:"win"},{code:"AltLeft",key:"altLeft"},{code:"Space",key:"space"},{code:"AltRight",key:"altRight"},{code:"ArrowLeft",key:"◄"},{code:"ArrowDown",key:"▼"},{code:"ArrowRight",key:"►"},{code:"ControlRight",key:"ctrlRight"}],n=[{code:"Backquote",key:"ё"},{code:"Digit1",key:"1"},{code:"Digit2",key:"2"},{code:"Digit3",key:"3"},{code:"Digit4",key:"4"},{code:"Digit5",key:"5"},{code:"Digit6",key:"6"},{code:"Digit7",key:"7"},{code:"Digit8",key:"8"},{code:"Digit9",key:"9"},{code:"Digit0",key:"0"},{code:"Minus",key:"-"},{code:"Equal",key:"="},{code:"Backspace",key:"backspace"},{code:"Tab",key:"tab"},{code:"KeyQ",key:"й"},{code:"KeyW",key:"ц"},{code:"KeyE",key:"у"},{code:"KeyR",key:"к"},{code:"KeyT",key:"е"},{code:"KeyY",key:"н"},{code:"KeyU",key:"г"},{code:"KeyI",key:"ш"},{code:"KeyO",key:"щ"},{code:"KeyP",key:"з"},{code:"BracketLeft",key:"х"},{code:"BracketRight",key:"ъ"},{code:"Backslash",key:"\\"},{code:"Delete",key:"del"},{code:"CapsLock",key:"caps"},{code:"KeyA",key:"ф"},{code:"KeyS",key:"ы"},{code:"KeyD",key:"в"},{code:"KeyF",key:"а"},{code:"KeyG",key:"п"},{code:"KeyH",key:"р"},{code:"KeyJ",key:"о"},{code:"KeyK",key:"л"},{code:"KeyL",key:"д"},{code:"Semicolon",key:"ж"},{code:"Quote",key:"э"},{code:"Enter",key:"enter"},{code:"ShiftLeft",key:"shiftLeft"},{code:"KeyZ",key:"я"},{code:"KeyX",key:"ч"},{code:"KeyC",key:"с"},{code:"KeyV",key:"м"},{code:"KeyB",key:"и"},{code:"KeyN",key:"т"},{code:"KeyM",key:"ь"},{code:"Comma",key:"б"},{code:"Period",key:"ю"},{code:"Slash",key:"."},{code:"ArrowUp",key:"▲"},{code:"ShiftRight",key:"shiftRight"},{code:"ControlLeft",key:"ctrlLeft"},{code:"MetaLeft",key:"win"},{code:"AltLeft",key:"altLeft"},{code:"Space",key:"space"},{code:"AltRight",key:"altRight"},{code:"ArrowLeft",key:"◄"},{code:"ArrowDown",key:"▼"},{code:"ArrowRight",key:"►"},{code:"ControlRight",key:"ctrlRight"}],s={en:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+","[":"{","]":"}",";":":","'":'"',",":"<",".":">","/":"?","\\":"/"},ru:{1:"!",2:'"',3:"№",4:";",5:"%",6:":",7:"?",8:"*",9:"(",0:")","-":"_","=":"+",".":",","\\":"/"}},o={en:{"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=","{":"[","}":"]",":":";",'"':"'","<":",",">":".","?":"/","/":"\\"},ru:{"!":"1",'"':"2","№":"3",";":"4","%":"5",":":"6","?":"7","*":"8","(":"9",")":"0",_:"-","+":"=",",":".","/":"\\"}};function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function c(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==r(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,"string");if("object"!==r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(a.key),"symbol"===r(n)?n:String(n)),a)}var n}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyboardInput=t,this.value="",this.capsLock=!1,this.isLeftShiftPressed=!1,this.isRightShiftPressed=!1,this.isVirtualShiftPressedRight=!1,this.isVirtualShiftPressedLeft=!1,this.keys=null}var t,i;return t=e,(i=[{key:"checkIfVirtualShiftRight",value:function(){return this.isVirtualShiftPressedRight}},{key:"checkIfVirtualShiftLeft",value:function(){return this.isVirtualShiftPressedLeft}},{key:"checkIfCaps",value:function(){return this.capsLock}},{key:"checkIfShift",value:function(){return this.isLeftShiftPressed||this.isRightShiftPressed||this.isVirtualShiftPressedLeft||this.isVirtualShiftPressedRight}},{key:"checkWhichShift",value:function(){this.isLeftShiftPressed&&document.querySelector('[data-code="ShiftLeft"]').classList.add("keyboard__key_active"),this.isRightShiftPressed&&document.querySelector('[data-code="ShiftRight"]').classList.add("keyboard__key_active")}},{key:"findKey",value:function(e){this.keys=document.querySelectorAll(".keyboard__key");var t=Array.from(this.keys).find((function(t){var i=t.getAttribute("data-code");return e===i}));"Shift"!==t.innerHTML?t.classList.add("keyboard__key_act"):t.classList.add("keyboard__key_active")}},{key:"updateInput",value:function(){this.keyboardInput.value=this.value}},{key:"handleEnter",value:function(){var e=this.keyboardInput.selectionStart;e===this.value.length?this.value+="\n":this.value="".concat(this.value.substring(0,e),"\n").concat(this.value.substring(e)),this.updateInput(),this.keyboardInput.setSelectionRange(e+1,e+1),this.keyboardInput.focus()}},{key:"handleDel",value:function(){var e=this.keyboardInput.selectionStart,t=this.keyboardInput.selectionEnd;e!==t?this.value=this.value.slice(0,e)+this.value.slice(t):e!==this.value.length&&(this.value=this.value.slice(0,e)+this.value.slice(e+1)),this.updateInput(),this.keyboardInput.setSelectionRange(e,e),this.keyboardInput.focus()}},{key:"handleTab",value:function(){var e=this.keyboardInput.selectionStart;e===this.value.length?this.value+="\t":this.value="".concat(this.value.substring(0,e),"\t").concat(this.value.substring(e)),this.updateInput(),this.keyboardInput.setSelectionRange(e+1,e+1),this.keyboardInput.focus()}},{key:"handleSpace",value:function(){var e=this.keyboardInput.selectionStart;e===this.value.length?this.value+=" ":this.value="".concat(this.value.substring(0,e)," ").concat(this.value.substring(e)),this.updateInput(),this.keyboardInput.setSelectionRange(e+1,e+1),this.keyboardInput.focus()}},{key:"handleAddDefaultKeys",value:function(e){var t=this.keyboardInput.selectionStart;t===this.value.length?this.value+=e.textContent:this.value=this.value.substring(0,t)+e.textContent+this.value.substring(t),this.updateInput(),this.keyboardInput.setSelectionRange(t+1,t+1),this.keyboardInput.focus()}},{key:"handleBackspace",value:function(){var e=this.keyboardInput.selectionStart,t=this.keyboardInput.selectionEnd;0===e&&0===t||(e!==t?(this.value=this.value.substring(0,e)+this.value.substring(t),this.updateInput(),this.keyboardInput.setSelectionRange(e,e)):(this.value=this.value.slice(0,e-1)+this.value.slice(e),this.updateInput(),this.keyboardInput.setSelectionRange(e-1,e-1)),this.keyboardInput.focus())}},{key:"toggleCapsLock",value:function(){var e=this,t=document.querySelectorAll(".keyboard__key");this.capsLock=!this.capsLock;var i=this.isLeftShiftPressed||this.isRightShiftPressed||this.isVirtualShiftPressedLeft||this.isVirtualShiftPressedRight;t.forEach((function(t){var a=t;1===a.textContent.length&&(e.capsLock?a.textContent=i?a.textContent.toLowerCase():a.textContent.toUpperCase():a.textContent=i?a.textContent.toUpperCase():a.textContent.toLowerCase())}))}},{key:"toggleShiftLeft",value:function(e){this.isLeftShiftPressed||this.isRightShiftPressed||this.isVirtualShiftPressedRight||(this.isVirtualShiftPressedLeft?(this.handleShiftUp(),this.isVirtualShiftPressedLeft=!1,e.classList.remove("keyboard__key_shift_active")):(this.handleShiftDown(),this.isVirtualShiftPressedLeft=!0,e.classList.add("keyboard__key_shift_active")))}},{key:"toggleShiftRight",value:function(e){this.isLeftShiftPressed||this.isRightShiftPressed||this.isVirtualShiftPressedLeft||(this.isVirtualShiftPressedRight?(this.handleShiftUp(),this.isVirtualShiftPressedRight=!1,e.classList.remove("keyboard__key_shift_active")):(this.handleShiftDown(),this.isVirtualShiftPressedRight=!0,e.classList.add("keyboard__key_shift_active")))}},{key:"handleShiftDown",value:function(){var e=this,t=document.querySelectorAll(".keyboard__key"),i=localStorage.getItem("lang");t.forEach((function(t){var a=t;e.capsLock&&1===a.textContent.length?a.textContent=a.textContent.toLowerCase():1===a.textContent.length&&(a.textContent=a.textContent.toUpperCase()),"en"===i&&Object.prototype.hasOwnProperty.call(s.en,a.textContent)?a.textContent=s.en[a.textContent]:"ru"===i&&Object.prototype.hasOwnProperty.call(s.ru,a.textContent)&&(a.textContent=s.ru[a.textContent])}))}},{key:"handleShiftUp",value:function(){var e=this,t=document.querySelectorAll(".keyboard__key"),i=localStorage.getItem("lang");t.forEach((function(t){var a=t;e.capsLock&&1===a.textContent.length?a.textContent=a.textContent.toUpperCase():1===a.textContent.length&&(a.textContent=a.textContent.toLowerCase()),"en"===i&&Object.prototype.hasOwnProperty.call(o.en,a.textContent)?a.textContent=o.en[a.textContent]:"ru"===i&&Object.prototype.hasOwnProperty.call(o.ru,a.textContent)&&(a.textContent=o.ru[a.textContent])}))}},{key:"handleRightShiftKeyDown",value:function(e){this.isLeftShiftPressed||this.isRightShiftPressed||this.isVirtualShiftPressedLeft||this.isVirtualShiftPressedRight||(this.isRightShiftPressed=!0,this.handleShiftDown(),this.findKey(e))}},{key:"handleLeftShiftKeyDown",value:function(e){this.isLeftShiftPressed||this.isVirtualShiftPressedLeft||this.isVirtualShiftPressedRight||this.isRightShiftPressed||(this.isLeftShiftPressed=!0,this.handleShiftDown(),this.findKey(e))}},{key:"handleShiftKeyUp",value:function(){this.isRightShiftPressed&&!this.isLeftShiftPressed?(this.isRightShiftPressed=!1,this.handleShiftUp(),document.querySelector('[data-code="ShiftRight"]').classList.remove("keyboard__key_active")):this.isLeftShiftPressed&&!this.isRightShiftPressed&&(this.isLeftShiftPressed=!1,this.handleShiftUp(),document.querySelector('[data-code="ShiftLeft"]').classList.remove("keyboard__key_active"))}}])&&c(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==d(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,"string");if("object"!==d(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(a.key),"symbol"===d(n)?n:String(n)),a)}var n}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyLayout=[],this.input=t,this.virtualKey=null,this.pressedKeys=[]}var t,i;return t=e,(i=[{key:"findAmongKeys",value:function(e){var t=document.querySelectorAll(".keyboard__key");this.virtualKey=Array.from(t).find((function(t){var i=t.getAttribute("data-code");return e===i}))}},{key:"pressKey",value:function(e){this.findAmongKeys(e),this.virtualKey&&this.virtualKey.classList.add("keyboard__key_act")}},{key:"releaseKey",value:function(e){this.findAmongKeys(e),this.virtualKey&&("Shift"!==this.virtualKey.innerHTML?this.virtualKey.classList.remove("keyboard__key_act"):this.virtualKey.classList.remove("keyboard__key_active"))}},{key:"addDefaultKeys",value:function(e){this.pressKey(e),this.virtualKey&&this.input.handleAddDefaultKeys(this.virtualKey)}},{key:"handleEnterKey",value:function(e){this.pressKey(e),this.virtualKey&&this.input.handleEnter()}},{key:"handleTabKey",value:function(e){this.pressKey(e),this.virtualKey&&this.input.handleTab()}},{key:"handleDelKey",value:function(e){this.pressKey(e),this.virtualKey&&this.input.handleDel()}},{key:"handleSpaceKey",value:function(e){this.pressKey(e),this.virtualKey&&this.input.handleSpace()}},{key:"handleBackspaceKey",value:function(e){this.pressKey(e),this.virtualKey&&this.input.handleBackspace()}},{key:"handleCapsLockKey",value:function(e,t){t||(this.pressKey(e),this.virtualKey&&(this.input.toggleCapsLock(),this.virtualKey.classList.toggle("keyboard__key--active")))}},{key:"handleRightShiftKey",value:function(e){this.input.handleRightShiftKeyDown(e)}},{key:"handleLeftShiftKey",value:function(e){this.input.handleLeftShiftKeyDown(e)}},{key:"releaseShiftKey",value:function(){this.input.handleShiftKeyUp()}},{key:"toggleLanguage",value:function(){var e=localStorage.getItem("lang");"en"===e?(localStorage.setItem("lang","ru"),this.keyLayout=n):"ru"===e&&(localStorage.setItem("lang","en"),this.keyLayout=a)}},{key:"makeKeys",value:function(){var e=this,t=document.createDocumentFragment(),i=this.pressedKeys.map((function(e){return e.code}));return localStorage.getItem("lang")&&"en"!==localStorage.getItem("lang")?this.keyLayout=n:(this.keyLayout=a,localStorage.setItem("lang","en")),this.keyLayout.forEach((function(a){var n=document.createElement("button");switch(n.setAttribute("type","button"),n.setAttribute("data-code","".concat(a.code)),n.classList.add("keyboard__key"),i.includes(a.code)&&n.classList.add("keyboard__key_act"),n.addEventListener("mousedown",(function(){n.classList.add("keyboard__key_act"),e.pressedKeys.push(a)})),n.addEventListener("mouseup",(function(){n.classList.remove("keyboard__key_act");var t=e.pressedKeys.findIndex((function(e){return e.code===a.code}));t>-1&&e.pressedKeys.splice(t,1)})),n.addEventListener("mouseleave",(function(){n.classList.remove("keyboard__key_act");var t=e.pressedKeys.findIndex((function(e){return e.code===a.code}));t>-1&&e.pressedKeys.splice(t,1)})),a.key){case"enter":n.classList.add("keyboard__key_wide"),n.textContent="Enter",n.addEventListener("click",(function(){e.input.handleEnter()}));break;case"tab":n.classList.add("keyboard__key_normal"),n.textContent="Tab",n.addEventListener("click",(function(){e.input.handleTab()}));break;case"del":n.textContent="Del",n.classList.add("keyboard__key_normal"),n.addEventListener("click",(function(){e.input.handleDel()}));break;case"space":n.classList.add("keyboard__key_super-wide"),n.addEventListener("click",(function(){e.input.handleSpace()}));break;case"backspace":n.classList.add("keyboard__key_wide"),n.textContent="Backspace",n.addEventListener("click",(function(){e.input.handleBackspace()}));break;case"caps":n.classList.add("keyboard__key_wide","keyboard__key--activatable"),n.textContent="CapsLock",e.input.checkIfCaps()&&n.classList.add("keyboard__key--active"),n.addEventListener("click",(function(){e.input.toggleCapsLock(),n.classList.toggle("keyboard__key--active")}));break;case"shiftRight":n.classList.add("keyboard__key_wide"),n.textContent="Shift",e.input.checkIfVirtualShiftRight()&&n.classList.add("keyboard__key_shift_active"),n.addEventListener("click",(function(){e.input.toggleShiftRight(n)}));break;case"shiftLeft":n.classList.add("keyboard__key_wide"),n.textContent="Shift",e.input.checkIfVirtualShiftLeft()&&n.classList.add("keyboard__key_shift_active"),n.addEventListener("click",(function(){e.input.toggleShiftLeft(n)}));break;case"ctrlLeft":case"ctrlRight":n.textContent="Ctrl";break;case"altLeft":case"altRight":n.textContent="Alt";break;case"win":n.textContent="Win";break;default:n.textContent=e.input.checkIfCaps()?a.key.toUpperCase():a.key.toLowerCase(),n.addEventListener("click",(function(){e.input.handleAddDefaultKeys(n)}))}t.appendChild(n)})),t}}])&&l(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),u=document.createElement("h1");u.textContent="RSS Virtual Keyboard",document.body.append(u);var k=document.createElement("p");k.classList.add("text"),k.textContent="Клавиатура создана в операционной системе Windows. Для переключения языка: левые ctrl + alt",document.body.append(k);var f=document.createElement("textarea");f.classList.add("keyboard-input"),document.body.append(f),f.addEventListener("keypress",(function(e){e.preventDefault()}));var p=new y(f),v=new h(p),b=new i(v.makeKeys());window.addEventListener("DOMContentLoaded",(function(){b.init()})),document.addEventListener("keydown",(function(e){e.preventDefault();var t=e.ctrlKey,i=e.altKey,a=e.code,n=e.repeat;if(t&&i){if(n)return;setTimeout((function(){v.toggleLanguage();var e=v.makeKeys();b.updateLanguage(e),p.checkIfShift()&&(p.handleShiftDown(),p.checkWhichShift())}),200)}switch(a){case"Enter":v.handleEnterKey(a);break;case"Tab":v.handleTabKey(a);break;case"Delete":v.handleDelKey(a);break;case"Space":v.handleSpaceKey(a);break;case"Backspace":v.handleBackspaceKey(a);break;case"CapsLock":v.handleCapsLockKey(a,e.repeat);break;case"ShiftRight":v.handleRightShiftKey(a);break;case"ShiftLeft":v.handleLeftShiftKey(a);break;case"ControlLeft":case"ControlRight":case"AltLeft":case"AltRight":case"MetaLeft":v.pressKey(a);break;default:v.addDefaultKeys(a)}})),document.addEventListener("keyup",(function(e){e.preventDefault();var t=e.code;"ShiftLeft"!==t&&"ShiftRight"!==t||v.releaseShiftKey(),v.releaseKey(t)}))})();